'''
'''  This demonstration shows the PROGMEM on the Serial Terminal.
'''
''' This shows code for writing and reading values onto the PROGMEM or PFM.
'''
'''
''' If you read the chip and look at the memory locations 0xFFC0 to 0xFFFE - you will see the correct values.


'''************************************************************************
'''@author  EvanV
'''@licence GPL
'''@version 1.01
'''@date    03/01/2022
' ----- Configuration

'Chip Settings.
#CHIP 18F27Q83
#OPTION Explicit


    'Generated by PIC PPS Tool for Great Cow Basic
    'PPS Tool version: 0.0.6.1
    'PinManager data: v1.79.0
    'Generated for 18F27Q83
    '
    'Template comment at the start of the config file
    '
    #startup InitPPS, 85
    #define PPSToolPart 18F27Q83

    Sub InitPPS

            'Module: UART pin directions
            Dir PORTC.6 Out    ' Make TX1 pin an output
            'Module: UART1
            RC6PPS = 0x0020    'TX1 > RC6

    End Sub
    'Template comment at the end of the config file

'' -------------------PORTA----------------
'' Bit#:  -7---6---5---4---3---2---1---0---
'' IO:    ---------------------------------
''-----------------------------------------
''

'' -------------------PORTB----------------
'' Bit#:  -7---6---5---4---3---2---1---0---
'' IO:    --------IN-LED--LED-LED LED -----
''-----------------------------------------
''

'' ------------------PORTC-----------------
'' Bit#:  -7---6---5---4---3---2---1---0---
'' IO:    ----TX---------------------------
''-----------------------------------------
''

'' ------------------PORTE-----------------
'' Bit#:  -7---6---5---4---3---2---1---0---
'' IO:    ----------------RST--------------
''-----------------------------------------
''

'Define constants to make things easier. We can reuse these at any time.
#DEFINE LEDD1 PORTB.1
#DEFINE LEDD2 PORTB.2
#DEFINE LEDD3 PORTB.3
#DEFINE LEDD4 PORTB.4
#DEFINE LEDPORT LATB


Dir     LEDD1         Out
Dir     LEDD2         Out
Dir     LEDD3         Out
Dir     LEDD4         Out

#DEFINE POTENTIOMETER PORTA.0
Dir     POTENTIOMETER In
#DEFINE SWITCHIN      PORTB.5
Dir     SWITCHIN      In

'Setup Serial port
#DEFINE USART_BAUD_RATE 9600
#DEFINE USART_TX_BLOCKING


'*****************************************************************************************************
'Main program commences here.. everything before this is setup for the board.
' Now assumes Serial Terminal is operational

Dim  PFMAddress, DataWord as Word

wait 1 s
HSerPrintCRLF 2

  'PFMReadWord


  'We are reading words, so we send the PFMAddress address every two bytes (a word).
  for PFMAddress = 0x0000 to 0x001F - 2 step 2  #IGNOREWARNING

      'Display the value
      HSerPrint "0x"
      HSerPrint hex(PFMAddress_h)
      HSerPrint hex(PFMAddress)
      HSerSend 9
      HSerSend 9

      'Read the value of the PFMAddress to the PFM
      'PFMRead  ( PFMAddress, DataWord )
      DataWord = PFMReadWord  ( PFMAddress)

      'Display the received value
      HSerPrint "0x"
      HSerPrint hex(DataWord_h)
      HSerPrint hex(DataWord)
      HSerPrintCRLF

  Next
  HSerPrintCRLF

'PFMWrite
  PFMWrite ( 0x00FFF0, 0x55 )
  PFMWrite ( 0x00FFFC, 0x1234 )

  'We are reading words, so we send the PFMAddress address every two bytes (a word).
  for PFMAddress = 0xFFF0 to 0xFFFF - 2 step 2 #IGNOREWARNING

      'Display the value
      HSerPrint "0x"
      HSerPrint hex(PFMAddress_h)
      HSerPrint hex(PFMAddress)
      HSerSend 9
      HSerSend 9

      'Read the value of the PFMAddress to the PFM
      PFMRead  ( PFMAddress, DataWord )
      'DataWord = PFMReadWord  ( PFMAddress)

      'Display the received value
      HSerPrint "0x"
      HSerPrint hex(DataWord_h)
      HSerPrint hex(DataWord)
      HSerPrintCRLF

  Next
  HSerPrintCRLF

do
loop
